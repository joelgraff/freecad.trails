from FreeCAD import Vector
import Part

from pivy import coin

from DraftGui import todo
import FreeCADGui as Gui
import FreeCAD as App

from ..project.support.geo_group import GeoGroup, GeoEnums

from pivy_trackers.tracker.line_tracker import LineTracker
from pivy_trackers.tracker.context_tracker import ContextTracker

from pivy_trackers.coin.coin_enums import NodeTypes as Nodes

class GeoRefTracker(ContextTracker):
    """
    Test georeferencing
    """

    def __init__(self, coords):
        """
        Constructor
        """

        super().__init__('geo_ref_tracker', Gui.ActiveDocument.ActiveView)

        self.system = ['UTM', 'Z35', 'FLAT']
        self.position = (4275011518.128912, 507510589.4751387, 0.0)
        self.view_state.set_geo_reference(self.system, self.position)

        #self.manual(self.base.top, coords)
        self.line(self.base.top, coords)

        self.base.set_visibility()
        self.insert_into_scenegraph(verbose=True)

    def manual(self, parent, coords):

        self.coord =\
            self.base.add_node(Nodes.GEO_COORDINATE, 'GEO_COORDINATE', parent, index=0)

        self.coord.geoSystem.setValues(self.system)
        self.coord.point.values = coords

        self.line =\
            self.base.add_node(Nodes.LINE_SET, 'GEO_LINE', parent, index=1)

    def line(self, parent, coords):


        self.line_tracker = LineTracker('GEO_LINE_TRACKER', coords, parent, is_geo=True)

        self.line_tracker.set_geo_reference(self.system, self.position)

points = [
    Vector (4275011518.128912, 507510589.4751387, 0.0),
    Vector (4275011717.0043764, 507511569.4996429, 0.0),
    Vector (4275011913.4291606, 507512550.0182727, 0.0),
    Vector (4275012107.4020367, 507513531.0248998, 0.0),
    Vector (4275012298.921793, 507514512.5133929, 0.0),
    Vector (4275012487.987232, 507515494.4776178, 0.0),
    Vector (4275012674.5971723, 507516476.91143715, 0.0),
    Vector (4275012858.7504473, 507517459.80871075, 0.0),
    Vector (4275013040.445906, 507518443.1632955, 0.0),
    Vector (4275013219.6824136, 507519426.96904546, 0.0),
    Vector (4275013396.4588485, 507520411.21981186, 0.0),
    Vector (4275013570.774107, 507521395.9094431, 0.0),
    Vector (4275013742.6270995, 507522381.0317848, 0.0),
    Vector (4275013912.0167513, 507523366.5806801, 0.0),
    Vector (4275014078.942004, 507524352.5499692, 0.0),
    Vector (4275014243.401815, 507525338.93348986, 0.0),
    Vector (4275014405.3951554, 507526325.72507715, 0.0),
    Vector (4275014564.9210134, 507527312.9185637, 0.0),
    Vector (4275014721.9783916, 507528300.5077795, 0.0),
    Vector (4275014876.5663085, 507529288.48655206, 0.0),
    Vector (4275015028.6837983, 507530276.8487066, 0.0),
    Vector (4275015178.3299093, 507531265.58806586, 0.0),
    Vector (4275015325.5037074, 507532254.6984502, 0.0),
    Vector (4275015470.204272, 507533244.1736777, 0.0),
    Vector (4275015612.430699, 507534234.00756407, 0.0),
    Vector (4275015752.1820993, 507535224.19392294, 0.0),
    Vector (4275015889.4575996, 507536214.7265656, 0.0),
    Vector (4275016024.256342, 507537205.5993012, 0.0),
    Vector (4275016156.5774837, 507538196.80593693, 0.0),
    Vector (4275016286.420198, 507539188.3402776, 0.0),
    Vector (4275016413.783673, 507540180.19612616, 0.0),
    Vector (4275016538.6671133, 507541172.3672835, 0.0),
    Vector (4275016661.069738, 507542164.84754866, 0.0),
    Vector (4275016780.990782, 507543157.6307185, 0.0),
    Vector (4275016898.429496, 507544150.7105882, 0.0),
    Vector (4275017013.3851457, 507545144.08095104, 0.0),
    Vector (4275017125.857013, 507546137.7355984, 0.0),
    Vector (4275017235.8443947, 507547131.66832, 0.0),
    Vector (4275017343.346604, 507548125.8729037, 0.0),
    Vector (4275017448.362968, 507549120.3431357, 0.0),
    Vector (4275017550.892831, 507550115.0728007, 0.0),
    Vector (4275017650.9355516, 507551110.0556815, 0.0),
    Vector (4275017748.4905057, 507552105.2855596, 0.0),
    Vector (4275017843.557082, 507553100.7562147, 0.0),
    Vector (4275017936.134688, 507554096.4614251, 0.0),
    Vector (4275018026.222744, 507555092.39496773, 0.0),
    Vector (4275018113.820687, 507556088.550618, 0.0),
    Vector (4275018198.92797, 507557084.9221499, 0.0),
    Vector (4275018281.5440607, 507558081.50333613, 0.0),
    Vector (4275018361.6684427, 507559078.287948, 0.0),
    Vector (4275018439.3006153, 507560075.2697558, 0.0),
    Vector (4275018514.4400935, 507561072.4425281, 0.0),
    Vector (4275018587.0864077, 507562069.80003285, 0.0),
    Vector (4275018657.239104, 507563067.3360364, 0.0),
    Vector (4275018724.897743, 507564065.04430425, 0.0),
    Vector (4275018790.061903, 507565062.9186007, 0.0),
    Vector (4275018852.731176, 507566060.95268893, 0.0),
    Vector (4275018912.905171, 507567059.1403314, 0.0),
    Vector (4275018970.583511, 507568057.47528934, 0.0),
    Vector (4275019025.765836, 507569055.95132315, 0.0),
    Vector (4275019078.451801, 507570054.56219244, 0.0),
    Vector (4275019128.6410766, 507571053.3016559, 0.0),
    Vector (4275019176.3333497, 507572052.1634713, 0.0),
    Vector (4275019221.5283217, 507573051.14139575, 0.0),
    Vector (4275019264.2257104, 507574050.2291858, 0.0),
    Vector (4275019304.4252486, 507575049.420597, 0.0),
    Vector (4275019342.1266856, 507576048.70938456, 0.0),
    Vector (4275019377.329785, 507577048.0893028, 0.0),
    Vector (4275019410.0343275, 507578047.5541056, 0.0),
    Vector (4275019440.240108, 507579047.09754634, 0.0),
    Vector (4275019467.9469385, 507580046.7133779, 0.0),
    Vector (4275019493.1546454, 507581046.39535266, 0.0),
    Vector (4275019515.863071, 507582046.13722265, 0.0),
    Vector (4275019536.072074, 507583045.93273944, 0.0),
    Vector (4275019553.781527, 507584045.7756543, 0.0),
    Vector (4275019568.9913206, 507585045.6597183, 0.0),
    Vector (4275019581.701359, 507586045.578682, 0.0),
    Vector (4275019591.9115624, 507587045.52629614, 0.0),
    Vector (4275019599.6218677, 507588045.49631083, 0.0),
    Vector (4275019604.8322268, 507589045.4824764, 0.0),
    Vector (4275019607.5426064, 507590045.4785429, 0.0),
    Vector (4275019607.7529902, 507591045.47826034, 0.0),
    Vector (4275019605.4633765, 507592045.47537875, 0.0),
    Vector (4275019600.67378, 507593045.46364814, 0.0),
    Vector (4275019593.3842306, 507594045.4368186, 0.0),
    Vector (4275019583.5947733, 507595045.3886403, 0.0),
    Vector (4275019571.3054695, 507596045.3128635, 0.0),
    Vector (4275019556.5163965, 507597045.2032388, 0.0),
    Vector (4275019539.2276464, 507598045.0535167, 0.0),
    Vector (4275019519.439327, 507599044.8574483, 0.0),
    Vector (4275019497.151562, 507600044.60878474, 0.0),
    Vector (4275019472.3644915, 507601044.3012776, 0.0),
    Vector (4275019445.0782695, 507602043.9286788, 0.0),
    Vector (4275019415.293067, 507603043.4847407, 0.0),
    Vector (4275019402.2241297, 507603457.47993255, 0.0)
]

points_2 = []

for _pt in points:
    points_2.append(_pt.sub(points[0]))

_tuples = [tuple(_v) for _v in points]

_tracker = GeoRefTracker(_tuples)
